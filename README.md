# About
This is a final project for the System Programming Laboratory course, at the Open University of Israel.

The goal is to implement a two-pass assembler for a custom-defined assembly language. \
The assembler translates assembly code into machine code for a simulated 10-bit computer architecture, \
handling input macros & labels, and generating output files.

## Project Specifications
This project is a direct implementation of the specifications detailed in the guide.pdf file:

* Written in ANSI C (C90 standard), as per "The C Programming Language" book, by K&R.
* Compiled with gcc using the flags: -Wall -ansi -pedantic.

The project was designed and tested on Ubuntu/Debian-based Linux distros (32-bit and 64-bit).

## Getting Started
Clone the repository:
```
git clone https://github.com/Valeriy-Kuvshinov/assembler.git
```

navigate to directory:
```
cd Labratory-C-Final-Project
```

A Makefile is provided, run the following to compile:
```
make
```

## Usage
Run the assembler from the terminal using the following syntax:
```
./assembler <file_name_1> <file_name_2> ... <file_name_n>
```

Example:
```
./assembler test1 test2 test3
```
Assembler will process the files `test1.as`, `test2.as`, and `test3.as`.

> [!CAUTION]
> The assembler expects to find files with the .as extension. \
> Writing a non-existent filename or including the extension in the command argument will terminate the program.

## Project Overview & File Types
The assembler processes input files in several stages, producing different output files:
**Input File**

* .as - The original assembly source code.

**Intermediate File (Generated by Pre-Assembler)**

* .am - The 'clean' assembly source code.

**Output Files (Generated by the Assembler)**

* .ob - The translated machine code.
* .ent - A list of all labels declared as .entry.
* .ext - A list of all references to symbols declared as .extern.

The assembler will not generate the .ob, .ent, or .ext files, if any errors are encountered during assembly. \
Clear error messages will be printed to stdout to guide the user.

> [!TIP]
> For ease of use, the repository contains a few examples of `.as` files. \
> The files can be found inside `good_tests` and `bad_tests` folders.

## Key Concepts from the Guide
**The Machine Model:**

* Word Size - 10 bits.
* Memory - 256 words.
* Registers - 8 general-purpose registers (r0 to r7) and a Program Status Word (PSW) register.

**Assembly Language Syntax**

16 Instructions:
| Instruction | Operands | Description |
| :---------- | :------- | :---------- |
| `mov`       | 2        | Move data   |
| `cmp`       | 2        | Compare     |
| `add`       | 2        | Add         |
| `sub`       | 2        | Subtract    |
| `lea`       | 2        | Load effective address |
| `clr`       | 1        | Clear (set to 0) |
| `not`       | 1        | Bitwise NOT |
| `inc`       | 1        | Increment   |
| `dec`       | 1        | Decrement   |
| `jmp`       | 1        | Unconditional jump |
| `bne`       | 1        | Branch if not equal (to zero) |
| `jsr`       | 1        | Jump to subroutine |
| `red`       | 1        | Read character from stdin |
| `prn`       | 1        | Print character to stdout |
| `rts`       | 0        | Return from subroutine |
| `stop`      | 0        | Halt execution |

4 addressing modes:

* 0 - Immediate - `#<value>` (e.g., `#-5`)
* 1 - Direct - `<label>` (e.g., `LOOP`)
* 2 - Matrix Access - `<label>[<rows_reg>][<cols_reg>]` (e.g., `MAT[r2][r5]`)
* 3 - Register Direct - `<register>` (e.g., `r1`)

5 directives:

* .data: Initializes a list of integers.
* .string: Initializes a null-terminated string.
* .mat: Defines a matrix (2D array) of integers.
* .entry: Declares a symbol (label) as available for use in other files.
* .extern: Declares that a symbol is defined in another file.

Macros:

* Must be defined at most once.
* Can be up to 30 characters long.
* Defined with `mcro <name>`.
* Terminated with `mcroend`.

Labels:

* Must be defined at most once.
* Can be up to 30 characters long.
* Format of `<name>:`
* Case-sensitive.

Comments:

* Lines that begin with `;`.

**Assembly Process**
Pre-Assembly - reading `.as` file:

* All macro definitions are stored.
* All comments and empty lines are excluded from the future output file.
* Every macro call is replaced by its body, outputting the `.am` file.

First Pass - reading `.am` file:

* The symbol table is built, assigning memory addresses to all labels.
* The instruction counter (IC) and data counter (DC) are maintained.
* The machine code for instructions with immediate or register operands is generated.
* References to labels in memory are left to be resolved in the second pass

Second Pass - reading `.am` file again:

* The symbol table is used to resolve the addresses of all labels used as operands.
* The machine code translation is completed, filling in all missing address references.
* The final object (.ob), entry (.ent), and external (.ext) files are written.
